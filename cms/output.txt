МИНИСТЕРСТВО ОБРАЗОВАНИЯ И НАУКИ
РОССИЙСКОЙ ФЕДЕРАЦИИ
Брянский государственный технический университет
Кафедра «Экономика, организация производства, управление»

КУРСОВАЯ РАБОТА
по дисциплине

«Интернет-программирование»

Разработка системы управления веб-контентом
в условиях АО «Брянскпиво»
Всего _______ листа

Выполнила:
студентка гр. 15-БИ
_________________ Мозолева Н.А.
«____» ___________________ 2018 г.
Проверил:
к. э. н., доцент
__________________ Дадыкин В.С.
«____» ___________________ 2018 г.

Брянск 2018

СОДЕРЖАНИЕ
Содержание .................................................................................................... 3
Введение......................................................................................................... 7
1. Характеристика объекта исследования АО «Брянскпиво» .................. 8
1.1. Краткая история предприятия .......................................................... 8
1.2. Современное состояние предприятия .............................................. 9
1.3. Характеристика выпускаемой продукции предприятия .............. 10
Производство пива .............................................................................. 10
Ржаной солод ....................................................................................... 18
2. Разработка системы управления веб-контентом в условиях АО
«Брянскпиво» ......................................................................................................... 20
2.1. Разработка и реализация физической и логической модели базы
данных ................................................................................................................ 20
2.2. Разработка и реализация интерфейсной части

системы

управления веб-контентом ............................................................................... 22
2.3.

Разработка

и

реализация

программной

части

системы

управления веб-контентом ............................................................................... 26
Заключение .................................................................................................. 27
Список используемой литературы ............................................................ 28
Приложения ................................................................................................. 29
Приложение 1 .............................................................................................. 30
Приложение 2 .............................................................................................. 33
Приложение 3 .............................................................................................. 35
Приложение 4 .............................................................................................. 36
Приложение 5 .............................................................................................. 37
3

Приложение 6 .............................................................................................. 38
Приложение 7 .............................................................................................. 39
Приложение 8 .............................................................................................. 41
Приложение 9 .............................................................................................. 42
Приложение 10 ............................................................................................ 43
Приложение 11 ............................................................................................ 44
Приложение 12 ............................................................................................ 45
Приложение 13 ............................................................................................ 46
Приложение 14 ............................................................................................ 48
Приложение 15 ............................................................................................ 50
Приложение 16 ............................................................................................ 51

4

6

ВВЕДЕНИЕ
Система управления веб-содержимым (Web Content Management
System или WCMS) — программный комплекс, предоставляющий функции
создания, редактирования, контроля и организации веб-страниц. WCMS
часто используются для создания блогов, личных страниц и интернетмагазинов

и

нацелены

на

пользователей,

мало

знакомых

с

программированием.
Целью данной

курсовой работы является разработка

системы

управления веб-контентом. Объектом исследования является региональное
мероприятие — пиво-солодовенный завод «Брянскпиво» (АО «Брянскпиво»).
В ходе выполнения курсовой работы решаются следующие задачи:
1.

Характеристика объекта исследования;

2.

Моделирование физической и логической модели базы данных;

3.

Моделирование и реализация интерфейсной части системы

управления веб-контентом;
4.

Разработка и реализация программной части системы управления

веб-контентом.
Для выполнения курсовой работы необходимо применить знания,
полученные на протяжении всего курса дисциплины — HTML, CSS, PHP и
SQL.

7

1. ХАРАКТЕРИСТИКА ОБЪЕКТА ИССЛЕДОВАНИЯ
АО «БРЯНСКПИВО»
1.1. Краткая история предприятия
В послевоенные годы на месте бывшего военного сухарного завода,
разрушенного

в

годы

Великой

Отечественной

Войны,

началось

строительство завода красного ржаного солода. В 1954 году он был сдан в
эксплуатацию. В 1971 году на базе завода красного ржаного солода был
основан пивобезалкогольный завод. В 1993 году предприятие реорганизовано
в Открытое акционерное общество «Брянскпиво».
2000-е годы ознаменованы для компании генеральной реконструкцией,
в ходе которой были запущены новые линии розлива напитков в стеклянную
тару

и

ПЭТ-бутылку

различной

ёмкости

ведущих

европейских

производителей, произведена полная замена трубопроводов.
В 2000 году на предприятие пришла новая команда управления,
созданы коммерческая служба и служба маркетинга.
С 2001 года введены системы бюджетирования и учёта. Разработана
маркетинговая стратегия предприятия и сбытовая система.
С 2001 года началась реконструкция солодовенного цеха с целью
увеличения

мощностей

предприятия

по

производству солода:

были

дополнительно смонтированы и введены в эксплуатацию 10 барабанов
ращения и ферментации ржаного солода.
В конце 2010 года началась новая модернизация производства, которая
позволила довести к 2014 году мощности по производству пива до 5 млн. дал
в год, по квасу — до 1,5 млн. дал в год, по ржаному солоду — до 18 тыс. тонн
в год, а также расширить ассортимент готовой продукции в соответствии с
потребительскими предпочтениями и рыночными тенденциями.
Уникальность производства состоит в том в работе по традиционной
классической технологии, и каждый сорт пива готовится по отдельному
8

рецепту. Сложные процессы варки, брожения и дображивания занимают
больше месяца, но имеют свой результат — пиво имеет неповторимый вкус!
Всё пиво компании «Брянскпиво» варится по ГОСТу, при этом для
каждого сорта выдерживается свой срок естественного брожения. Залог
достигнутого успеха — пристальное внимание к качеству продукции,
которое складывается из качественного сырья, современных технологий
производства продукции, постоянного контроля над производственным
процессом и слаженной работы профессионалов.
1.2. Современное состояние предприятия
Сегодня компания «Брянскпиво» выпускает 21 сорт пива: «Bierhaus
light» светлое, «Живое Хмельное» светлое,
темное,

«Байкер»

«Жигулёвское»

светлое,

светлое,

«Свень» светлое, «Свень»

«Колос»

светлое,

«Колос»

крепкий,

«Жигулёвское

особое»,

«Живое»,

«Живое

бочковое», «Stolz Премиум серебро», «Портер Английский» тёмное,
«Пражский

Град» светлое,

«Пражский

Град»

тёмное,

«Бельгийское

выдержанное» светлое, «Gessen светлое», «Gessen тёмное», «Свень золотое»,
«Бельгийское пшеничное», «Old Ams».
АО

«Брянскпиво»

—

крупнейший

производитель

ржаного

ферментированного и неферментированного солода в РФ и странах СНГ,
единственное

предприятие,

использующее

современный

способ

его

изготовления в барабанах Топфа.
Производство постоянно модернизируется. Сегодня автоматика и
программное обеспечение взяли на себя почти весь производственный
процесс приготовления пива. Пиво стало конкурентным. Вкус его
превосходит иные зарубежные бренды. В осуществлении реконструкции
ОАО «Брянскпиво» активно сотрудничает с известными европейскими
фирмами.
В отличие от многих производителей «Брянскпиво» соблюдает
знаменитый «закон о чистоте пива», своего рода кодекс уважающих себя
9

пивоваров — использовать только натуральные компоненты — ячмень,
хмель, воду, солод.
Помимо этого, в настоящее время предприятие владеет сетью баров
«Заводской бар», распространённых в Брянской, Орловской и Московской
областях; барами и ресторанами «Пивная бухта». Далее следует описание
ресторана «Пивная бухта»:
«Пивная бухта» предоставила столь редкую возможность погрузиться в
лёгкую, уютную атмосферу спокойствия.
Входя в ресторан, посетитель оказывается на борту дивного корабля.
На его пути встречается многообразие деталей с настоящих судов: начиная
от знакомых рыболовецких сетей и заканчивая настоящим старинным
компасом с торпедного катера 30-40 гг.
Полный оригинальными дизайнерскими решениями ресторан является
источником как гастрономического, так и творческого вдохновения. В нашем
ресторане творит шеф-повар — настоящий профессионал в своём деле,
отчего наша кухня стала неповторимо вкусной и полезной.
Вас приятно удивят своим изысканным вкусом не только уже знакомые
блюда, но и новые творения шеф-повара, ведь он умеет превратить обычную
еду в настоящий кулинарный шедевр».
1.3. Характеристика выпускаемой продукции предприятия
Производство пива
Многие из вас слышали о так называемом Баварском законе «О чистоте
пива» от 1516 года (Das Reinheitsgebot), который 5 веков назад
регламентировал состав «настоящего» честного пива. Так пиво должно
состоять только из хмеля, ячменного солода и воды. К сожалению, многие
пивоваренные компании сегодня по разным причинам отказываются
следовать этому негласному закону и нарушают традиционную технологию
производства пива.
10

«Брянскпиво» любит своего потребителя, наши специалисты и сегодня,
в 21 веке, продолжают действительно варить пиво, соблюдают технологию
естественного брожения, не добавляют консервантов и специальных модных
добавок и вкусовых улучшителей, как это делают многие другие компании.
Как известно, пиво на 90% состоит из воды, поэтому тщательно
очищенная вода является важнейшей составляющей пенного напитка.
Естественно, что «Брянскпиво» уделяет особое внимание её качеству и
составу: после очистки вода по своим химическим и микробиологическим
показателям соответствует самым высоким европейским стандартам.
На заводе «Брянскпиво» вода проходит специальную очистку в системе
многослойных песчаных, угольных и катионообменных фильтров. Фильтры
помогают удалить из воды вещества с неприятным запахом и вкусом,
например, соединения хлора. После прохождения через систему фильтров
вода получается кристально чистой и безвредной.
Пиво обладает многообразными вкусовыми оттенками, которые
зависят от воды. Так, некоторые сорта лучше варить на «жёсткой» воде, в то
время как для других больше подходит «мягкая» вода. Степень жёсткости
зависит от присутствия в воде солей кальция и магния. С помощью новейших
технологий на заводе «Брянскпиво» содержание солей в воде регулируется,
что позволяет выбирать для приготовления того или иного сорта пива воду
необходимой степени «жёсткости».
Одним из важных компонентов для производства пива является
ячменный солод. Компания «Брянскпиво» имеет в своём распоряжении
солодовни. Однако они предназначены для производства не ячменного, а
ржаного солода, который мы используем при производстве натурального
хлебного кваса.
Пивоваренный же солод мы закупаем у ведущих отечественных и
зарубежных производителей. Специалисты лаборатории отбирают образцы
полученного солода и проводят ряд специальных анализов, чтобы не
допустить некачественное сырье в производство. Мы всегда очень тщательно
11

относимся к качеству выпускаемой продукции — именно поэтому контроль
качества осуществляется на «Брянскпиво» от самого начала и до конца
производственного процесса, когда готовое пиво будет разлито в бутылки.
Полученный солод проходит тщательный процесс очистки на
сепараторе, а затем в специальной дробилке его измельчают до состояния
солодовой крупки, так называемого шрота, и далее отправляют на затирание,
которое является важным моментом в варочном процессе... В ходе затирания
в специальных заторных чанах солодовый помол смешивается с водой и
нагревается для перевода компонентов в растворимый экстракт. Во время
запаривания

происходит

активизация

пивоваренного

солода.

истечении

подвергается

кипячению.

По

В

всех

ферментов

определённого

результате

ячменного

времени

затор

чего

распаренный

солод

из

себя

осахаривается.
Осахаренный

затор

представляет

жидкость

с

нерастворившимися зернопродуктами, которая обязательно должна быть
подвергнута фильтрации. Для этого затор проходит через специальный
фильтр-чан. Этот процесс нужен для того, чтобы отделить нерастворимые
части солода (солодовую дробину) от сусла. Дробина, оставшаяся после
фильтрации, идёт на корм скоту, так как в ней содержится много полезных
белков. Сусло, в свою очередь, поступает в специальный сусловарочный чан,
в котором происходит процесс варки с охмелением.
Кроме солода для производства пива нам, конечно, нужен хмель.
Сказать, что хмель для пива важен — это не сказать ничего. Наряду с
солодом, хмель — это один из главных компонентов пива. Это его лицо, ведь
когда мы оцениваем пиво, то, прежде всего, отмечаем горечь и аромат
напитка — именно за них хмель и отвечает. Два основных назначения хмеля
— это придача пиву горечи и аромата. Соответственно, все сорта хмеля так и
распределяются: на сорта, в которых большое количество содержания
веществ, называемых альфа-кислотами, способствующих передачи горечи и
на сорта, где большое содержание ароматических веществ, называемых
12

хмелевые смолы, которые используются для передачи аромата пиву.
Кроме того, присутствие хмеля увеличивает биологическую стойкость
пива, а также благотворно влияет на образование пены и её стойкость.
Некоторые пивоваренные заводы используют непосредственно шишки
хмеля. Такой способ считается безвозвратно устаревшей технологией.
Сегодня все современные пивоваренные производства используют хмелевые
продукты. Они бывают двух видов: экстракт хмеля и гранулы хмеля.
Пивовары «Брянскпиво» используют при производстве своего пива хмель в
гранулах, предпочитают

импортный хмель немецкого и чешского

производства. Для придания свойственной пиву горечи применяются такие
известные сорта как «Наггет» и «Магнум», а для придания классического
аромата — «Премиант» и «Жатецкий».
На наше предприятие хмелевые гранулы поступают в вакуумных
упаковках, оберегающих продукт от контакта с кислородом, который очень
вреден, потому что ведёт к старению и быстрой порчи альфа-кислот.
Хранится хмель при низких температурах от 0 до +2ºС.
Итак, полученный после варки с хмелем продукт охлаждается до
температуры +8 -9 ºС и подаётся в танки бродильного отделения.
Охлаждение обязательно, так как для нормальной жизнедеятельности
дрожжей, под действием которых будет проходить брожение сусла
(превращение его в пиво), требуется определённая температура.
Одной из главных особенностей нашего производства является
технология приготовления пива. У нас процессы брожения пива и его
созревания протекают отдельно друг от друга, то есть пиво на каждой из этих
стадий находится в совершенно разных ёмкостях. Многие крупные
производители пива от этой, проверенной временем, технологии давно
отказались и готовят пиво в больших вертикальных ёмкостях, в которых оно
бродит и созревает в течение всего лишь 4-5 дней! Эти ёмкости
устанавливают вне помещений, а для охлаждения применяют аммиак. Кроме
того, большая часть производителей варит сначала так называемое
13

«материнское пиво», которое потом просто разбавляется водой до
необходимой плотности, а после уже добавляют стабилизаторы вкуса и
стойкости пены. Такое пиво никак не может приблизиться к параметрам
ГОСТа.
На «Брянскпиво» наши специалисты холят и лелеют пиво, которому
обязательно нужно достаточное количество времени (в течение 30 дней и
более), чтобы прошли все химические процессы, чтобы пиво действительно
созрело и приобрело настоящий вкус, аромат, горчинку, которые задумали
пивовары. «Брянскпиво» на своём региональном уровне ставит приоритеты
качества готового продукта на первое место, именно поэтому мы
продолжаем и сегодня варить пиво по-настоящему, позволяя процессу
приготовления напитка протекать так, как это было задумано много столетий
назад.
Брожение охмелённого сусла протекает в отдельных бродильных
танках. Каждый сорт пива бродит в своём танке, а никак не вместе. На
условия брожения особое влияние оказывают продолжительность процесса,
температура и давление в танках. Если хоть один из показателей отклонится
от нормы, ход брожения изменится и напиток потеряет свой вкус. На
«Брянскпиво» подобного произойти не может, так как процесс, практически
полностью автоматизирован.
По способу брожения пиво делится на два типа — эль и лагер. Элем
считается пиво верхового брожения, когда напиток бродит, как правило, при
комнатной температуре (15-24°С), и дрожжи поднимаются на поверхность
пива. Лагер же бродит при низких температурах, и дрожжи, наоборот,
опускаются на дно. Все девять сортов пива, которые выпускает сегодня наша
компания, относятся к лагерному пиву.
Обычно процесс брожения длится не менее недели. За это время
дрожжи, которые были заранее заложены в танк, постепенно размножаются,
поглощая

сахара,

которыми

богато

охмелённое

сусло.

Продуктом

переработки сахаров является этиловый спирт и углекислый газ. В результате
14

брожения получается молодое мутное пиво (иногда его ещё называют
«зелёным»), которое ещё не готово к употреблению.
После низового брожения молодое пиво попадает в лагерное
отделение, где происходит дображивание — длительное глубокое холодное
созревание пива, которое придаёт ему безупречный гармоничный вкус,
прозрачность и блеск!
Основная цель дображивания — карбонизация пива, т.е. насыщение
пива СО2. Углекислота (СО2.) — важнейшая составная часть пива, которая
придаёт ему приятный и освежающий вкус, способствует пенообразова­нию,
предохраняет пиво от соприкосновения с кислородом воздуха, служит
консервантом, подавляя развитие посторонних и вредных микроорганизмов.
При

созревании

пива

происходят

различные

окислительно-

восстановительные реакции, в результате которых исчезают характерные для
молодого пива привкус дрожжей и хмелевая горечь (происходит коагуляция
хмелевых смол). Вкус пива становится мягче, нежнее. В результате
дображивания остаточного экстракта, крепость пива несколько возрастает и
происходит его осветление.
Степень готовности пива определяет главный пивовар по физикохимическим и органолептическим показателям.
Готовое

пиво

должно

обязательно

пройти

несколько

стадий

окончательной фильтрации. На нашем предприятии этот процесс не упрощён
и осуществляется в несколько этапов.
На

первой

ступени

процесса

напиток

пропускается

сквозь

кизельгуровый фильтр, созданный из измельчённых панцирей ископаемых
водорослей.
Затем напиток проходит стадию тонкой очистки, где

в качестве

фильтра используются слои пищевого картона проходимостью 0,8 микрона.
Пиво буквально продавливается сквозь картон и, в результате, получается
очищенный, прозрачный продукт.
Кроме того, фильтрация позволяет сберечь вкус, цвет и остальные
15

важные свойства сваренного напитка и предоставить потребителю только
свежее, чистое пиво. Оно становится ясным и прозрачным, очищенным от
различных

микроорганизмов,

превращающих

хмельной

напиток

в

скоропортящийся продукт.
Таким образом, фильтрация позволяет повысить стойкость пива — т.е.
увеличить его сроки годности. В настоящее время сроки годности пива от
«Брянскпиво» колеблются от 30 до 120 суток (в зависимости от сорта),
однако ни один из наших сортов не может храниться 180 и более суток, как
пиво других производителей. Для длительного хранения пива (свыше
полугода) используются консерванты и специальные добавки, которые
искусственно увеличивают сроки годности пива и при этом убивают все
полезные микроорганизмы! Наиболее опасные из них могут вызывать
нарушения иммунитета (аутоиммунные и онкологические заболевания), а
также нарушения репродукции, т.е. воспроизведения здорового потомства!
Как известно, ГОСТ не допускает применения консервантов, ведь пиво с
добавками — это нечестное пиво!
При производстве брянского пива мы не используем специальных
добавок и консервантов. Наше пиво — натуральный, экологически чистый
продукт, который не может храниться непомерно долго. Придя в магазин,
обратите внимание на этикетки разных сортов пива разных производителей...
Вы обязательно увидите, что пиво от «Брянскпиво» сварено по ГОСТу и
хранится гораздо меньше, чем сорта широко разрекламированных крупных
пивоваренных компаний-гигантов.
После

тщательной

двухступенчатой

фильтрации

готовое

пиво

поступает в фарфасное отделение. Оно нужно для временного хранения
фильтрованного пива, готового к розливу и укупорке в бутылки или кеги
разной ёмкости.
В 2005-2006 гг. на «Брянскпиво» прошла реконструкция цеха розлива.
В результате, сегодня мы работаем на современном оборудовании, которое
значительно ускорило и упростило процесс розлива пива. В результате
16

модернизации была запущена новая линия розлива в стеклянную тару
(«Klinger», Австрия); в августе 2006 года запущена линия розлива пива в
пластиковую тару («Berchi», Италия); введена в эксплуатацию SIP-мойка,
очищающая ёмкости с помощью специальных моющих головок.
Так как пиво является скоропортящимся продуктом и подвержено
воздействию различных микроорганизмов, в процессе розлива мы тщательно
защищаем его от воздуха и загрязнений.
Наполненная пивом бутылка укупоривается пробкой. Затем бутылка с
пивом попадает во власть этикеровочной машины, которая наносит на
бутылку этикетки, контрэтикетки и кольеретки в зависимости от типа тары.
После того, как бутылки с пивом полностью готовы, они проходят
через установку термоупаковки и множество бутылок формируются в
удобные упаковки (по 20 бутылок для пива в стеклянной таре, по 6 бутылок
для пива в ПЭТ 1,5 л; по 9 бутылок для пива в ПЭТ 1 л и по 4 бутылки в ПЭТ
по 2,5 л).
Упаковки с пивом отправляются на склад, где из них формируются
большие паллеты, удобные для последующей погрузки и отправки в
торговые точки нашего города, а также соседних регионов.
На рис. 1 изображён процесс производства пива.

Рисунок 1 — Схема технологического процесса пивоварения
17

Ржаной солод
АО «Брянскпиво» — крупнейший производитель ферментированного
(красного) и неферментированного (белого) ржаного солода с 1954 года.
Единственное в России предприятие, использующее барабанную технологию
изготовления ржаного солода. В процессе производства солода мы
объединяем прошлое с настоящим, когда древний метод производства
контролируется с помощью современных технологий.
Ржаной

солод

изготавливается

Rumalt

из

ржи

в

процессе

солодовенного производства, которое включает в себя и использование
природных процессов в зерне. Продукт имеет глубокий вкус с богатым и
приятным ароматом

ржи.

Красно-коричневый

цвет ржаного

солода

эффективно влияет на цвет хлеба, особенно корочки за счёт развития
природных процессов брожения.
Зерно проходит строгий лабораторный контроль в аттестованной
лаборатории, оснащённой современными приборами контроля качества.
Специалисты

лаборатории

солода

и

солодовенного

производства

контролируют все стадии производства от приёмки зерна до выпуска готовой
продукции. Ржаной солод Rumalt — экологически чистый продукт, для
приготовления которого используются рожь, пар и вода.
Производство
подготовка

зерна

ржаного

солода состоит из

и

замачивание, проращивание,

ржи,

следующих

стадий:

ферментация

(томление), сушка, размол и хранение.
Барабанная технология позволяет производить более качественный
солод, чем солод, изготовленный ящичным способом. В барабане легче
регулировать температурный режим, солод лучше перемешивается, влага и
тепло

распределяются

равномерно,

благодаря

чему цвет

и

аромат

накапливаются более интенсивно. Ворошение зерна достигается вращением
самих барабанов, зерно ворошится и не травмируется.
Особенностью производства является использование специального
оборудования для ращения и ферментации солода, что придаёт солоду
18

характерный вкус, цвет и запах. Только с использованием барабанной
технологии можно добиться высокой цветности продукта.
Преимуществом

солодовни

барабанного

типа

является

индивидуальный подход к каждой партии зёрен в рамках ГОСТа.
Ржаной солод Rumalt — продукт класса премиум с самыми высокими
показателями качества в соответствии с ГОСТом! Ржаной солод Rumalt —
натуральный продукт высшего качества!
АО «Брянскпиво» является крупнейшим производителем ржаного
солода в России и странах СНГ. Сегодня АО «Брянскпиво» снабжает
хлебопекарные предприятия ржаным солодом самого высокого качества. В
любой точке России — от Калининграда до Владивостока, а также в
Беларуси, Украине, Молдове, Литве, Казахстане, Киргизии, Грузии,
Азербайджане,

Чехии,

Турции,

Франции,

Германии

поддерживаем

взаимовыгодные

партнёрские

отношения

компаниями-потребителями ржаного солода!

19

и

Китае
с

мы

ведущими

2. РАЗРАБОТКА СИСТЕМЫ УПРАВЛЕНИЯ
ВЕБ-КОНТЕНТОМ В УСЛОВИЯХ АО «БРЯНСКПИВО»
2.1. Разработка и реализация физической и логической модели базы
данных
Логическая схема — модель базы данных, выраженная в понятиях
модели данных. Этим отличается от концептуальной модели, описывающей
семантику предметной области без указания технологии (конкретных
методов реализации), и от физической модели, которая описывает
конкретные физические механизмы, применяемые для хранения данных в
накопителях.
Логическая модель предметной области иллюстрирует сущности, а
также их взаимоотношения между собой.
Целью

построения

логической

модели

является

получение

графического представления логической структуры исследуемой предметной
области.
На рис. 2 представлена логическая схема данных:

Рисунок 2 — Логическая схема данных

20

Физическая модель — логическая модель базы данных, выраженная в
терминах языка описания данных конкретной СУБД.
Физическая модель базы данных содержит все детали, необходимые
конкретной СУБД для создания базы: наименования таблиц и столбцов, типы
данных, определения первичных и внешних ключей и т.п.
Физическая модель БД определяет способ размещения данных в среде
хранения и способы доступа к этим данным, которые поддерживаются на
физическом уровне. Исторически первыми системами хранения и доступа
были файловые структуры и системы управления файлами (СУФ), которые
фактически являлись частью операционных систем. СУБД создавала над
этими

файловыми

моделями

свою

надстройку,

которая

позволяла

организовать всю совокупность файлов таким образом, чтобы она выглядела
как единое целое и получала централизованное управление от СУБД. Однако
непосредственный доступ осуществлялся на уровне файловых команд,
которые

СУБД

использовала

при

манипуляции

всеми

файлами,

составляющие хранимые данные одной или нескольких баз данных.
Физическая модель строится на основе логической с учётом
ограничений, накладываемых возможностями выбранной СУБД. Схема
физической модели данных представлена на рис. 3:

Рисунок 3 — Физическая схема данных
Далее базу необходимо заполнить. Пример заполненной таблицы базы
данных приведён на рис. 4, для вывода использовался запрос:
SELECT * FROM `products` WHERE `product_type`=”$product_type”;

21

Рисунок 4 — Заполненная таблица «Products»
2.2. Разработка и реализация интерфейсной части
системы управления веб-контентом
Термин «интерфейс» широко используется в областях, где человеку
приходится иметь дело с обработкой информации на компьютере. В переводе
с английского языка Interface означает «внешнее лицо». В компьютерном
мире

известно

множество

разновидностей

интерфейсов:

интерфейс

пользователя, графический интерфейс, интерфейс ввода-вывода, внешний
или

внутренний

интерфейс,

интеллектуальный

интерфейс,

человеко-

машинный интерфейс, программный интерфейс и т.д.
Интерфейс — совокупность средств и правил, которые обеспечивают
взаимодействие устройств, программ и человека.
Цвет и фон страницы выбирается по желанию, но нужно учитывать и
тот факт, что от них зависит визуальное восприятие всего сайта. Не нужно
все чрезмерно затемнять, текст удобно читать, если его хорошо видно. Не
следует применять чёрный цвет, мотивируя это продлением срока службы
мониторов пользователей. По

статистическим данным посещаемость

«чёрных» сайтов не очень высока.
Подбирая

цвет

фона,

необходимо

учитывать,

как

он

будет

гармонировать со всеми остальными элементами: цветом текста, цветом
гиперссылок. Крайне необходимо обеспечить достаточный цветовой и
яркостной контраст между навигационными элементами на странице и
фоном. Если в качестве фона используется изображение, то оно должно быть
22

едва заметным. Это изображение должно содержать только нейтральные,
неконтрастирующие друг с другом цвета.
Технология таблиц каскадных стилей (CSS) — это набор правил
оформления и формирования, которых может быть применён к различным
элементам Web-страницы. В стандартном языке HTML для присвоения
какому-либо элементу определённых свойств, таких как цвет, размер и тому
подобное — приходится каждый раз их заново описывать. Применяя
технологию CSS, достаточно будет один раз описать свойства элементов и
определить это описание как стиль.
В приложении 1 представлен листинг файла style.css, отвечающего за
единое оформление сайта.
Сайт состоит из семи основных страниц и семи вспомогательных (таких, как
подкатегории). Скриншоты сайтов представлены на рис. 5-10, а листинги
соответствующих страниц — в приложениях 3-.

Рисунок 5 — Входная страница (landing page)

23

Рисунок 6 — Главная страница

Рисунок 7 — Ассортимент пива

24

Рисунок 8 — Страница «Фотогалерея»

Рисунок 9 — Страница «Контакты»

25

Рисунок 10 — Страница «Опросы»
2.3. Разработка и реализация программной части
системы управления веб-контентом
Система управления веб–контентом разработана по схеме:
Шапка сайта  Наполнение  Подвал.
Для реализации поставленной задачи следует установить следующее
программное обеспечение OpenServer (пакет инструментов для вебразработки) и возможности языка PHP.
Для просмотра любого динамического сайта на персональном
компьютере нужен сервер или уже загруженный на хостинг и работающий
сайт. Но существует и альтернатива — комплекс OpenServerOpenServer
включает в себя несколько вариантов работы баз данных, браузеры и
различные инструменты отладки. Можно разрабатывать и тестировать сайты
в Windows, а затем быстро и легко переносить их на реальный хостинг.
Программная часть включает в себя разработку php–файлов. В
курсовом проекте разработано 29 php–файлов, листинги которых приведены
в приложениях.

26

ЗАКЛЮЧЕНИЕ
В данной курсовой работе были рассмотрены основные этапы создания
и поддержки работы современного Web-сайта.
Были решены следующие частные задачи:


ознакомление

с

современными

Интернет-технологиями

и

использование их в своей разработке;


изучение основных программы применяемых для разработки и

создания Web-сайта;


ознакомление с методами и способами представления на Web-

страницах различных видов информации (текстов и изображений);


ознакомление с основными правилами и рекомендациями по

разработке и созданию Web-сайтов и неукоснительное следование им в своей
практике;


определение структуры Web-страниц.

Кроме того, были решены следующие проектные задачи:
1. Дана полная характеристика объекта исследования;
2. Смоделирована физическая и логическая модель базы данных;
3. Смоделирована и реализована интерфейсная часть системы
управления веб-контентом;
4. Разработана и реализована программная часть системы управления
веб-контентом.

27

СПИСОК ИСПОЛЬЗУЕМОЙ ЛИТЕРАТУРЫ
1.

В.Дунаев. Базы данных. Язык SQL для студента. – СПб.: БХВ-

Петербург, 2012. – 320 с.
2.

А.В. Маркин, С.С. Шкарин. Основы Web-программирования на

PHP. – М.: Диалог-МИФИ, 2012. – 256 с.
3.

Дмитрий Котеров, Алексей Костарев. PHP 5. – СПб.: БХВ-

Петербург, 2016. – с.
4.

Люк Веллинг, Лора Томсон. Разработка веб-приложений с

помощью PHP и MySQL. – М.: Вильямс, 2010. – 848 с.
5.

Денис

Колисниченко.

PHP

и

MySQL.

Разработка

Web-

приложений. – СПб.: БХВ-Петербург, 2015. – 560 с.
6.

В.А. Новиков, А.В. Новиков, В.В. Матвеенко. Информационные

системы и сети (+ CD-ROM). – М.: Издательство Гревцова, 2014. – 448 с.
7.

Бретт Маклафлин. PHP и MySQL. Исчерпывающее руководство.

– СПб.: Питер, 2016. – 544 с.
8.

Каллум Хопкинс. PHP. Быстрый старт. – М.: Эксмо, 2014. – 160 с.

9.

Ларри Ульман. PHP и MySQL. Cоздание интернет-магазинов. –

М.: Вильямс, 2015. – 544 с.
10.

Мэтт

Зандстра.

PHP.

Объекты,

шаблоны

и

методики

программирования. – М.: Вильямс, 2015. – 576 с.
11.

Кристиан Уэнц. PHP и MySQL. Карманный справочник. – М.:

Вильямс, 2015. – 256 с.
12.

Джош Локхарт. Современный PHP. Новые возможности и

передовой опыт. – М.: ДМК Пресс, 2016. – 304 с.
13.

Робин Никсон. Создаем динамические веб-сайты с помощью

PHP, MySQL, JavaScript, CSS и HTML5. – СПб.: Питер, 2016. – 768 с.

28

ПРИЛОЖЕНИЯ

29

ПРИЛОЖЕНИЕ 1
Листинг файла style.css
body {background-color: #391800;
background-image: url(http://www.tokkoro.com/picsup/394506wood-background-hd.jpg);
}
header {background-color: rgba(255, 202, 55, 0.3);
width: 95%;
margin: auto;
border-radius: 1rem;
}
header img {width: 125px;
position: absolute;
left: 5%;
top: 9%;
}
header h1{color: #9D0800;
font-size: 4rem;
text-align: center;
font-family: 'Black Rose Swash', 'Nocturne Victorian',
'Eccentric',
'Montesuma', 'Times New Roman';
text-shadow: 0 0 1em #cc5200;
}
.nav {position: absolute;
top: 31%;
left: 2.5%;
width: 95%;
}
.nav table {width: 100%;
height: 2em;
background-color: #A53A00;
border-width: 1px;
border-color: #FFA500;
border-radius: 5px;
}
.nav td {border-color: #FFC400;
border-style:dotted;
border-width:1px;
text-align:center;
}
.nav a {font-family: 'Times New Roman';
color: #522900;
text-decoration: none;

30

}
.nav td a:hover {color: #FFFF00;
text-decoration: underline;
background-color: #5D3100;
}
.content {position: absolute;
width: 95%;
top: 37%;
left: 2.5%;
background-color: rgba(255, 202, 55, 0.3);
border-radius: 5px;
color: #4C2700;
}
.content h1 {color: #FF5A00;
font-size: 2em;
font-style: bold;
text-align: center;
}
.ArticleList td {background-color: rgba(255, 231, 138, 0.3);
width: 70%;
border-radius: 5px;
border-color: #A54900;
}
.ArticleList h4 {font-style: bold;
color: #763400;
}
ul a {font-size: 2em;
text-decoration: none;
color: #FFC300;
}
.content th {background-color: rgba(255, 203, 31, 0.3);
color: #FF7A00;
}
.content td {background-color: rgba(255, 231, 138, 0.3);
width: 70%;
border-radius: 5px;
border-color: #A54900;
}
.PromoList td {background-color: rgba(255, 231, 138, 0.3);
width: 100%;
border-radius: 5px;
border-color: #A54900;
position: absolute;

31

left: 20%;
}
td img {height: 20%;
}
.footer {background-color: rgba(255, 202, 55, 0.3);
width: 95%;
margin: auto;
border-radius: 1rem;
position: absolute;
top: 105%;
left: 2.5%;
text-align: center;
}

32

ПРИЛОЖЕНИЕ 2
Листинг файла landing.css
/*Этот файл отвечает за внешний вид страницы возрастного
ограничения*/
body {background-color: #3E1600;
}
.background {background-image: url(http://proudofukraine.com/wpcontent/uploads/2015/09/ukrainian-beer.jpg);
width: 70%;
height: 100%;
margin: auto;
}
img {opacity: 0.3;
width: 100%;
}
h1 {color: rgba(255, 255, 255, 0.4);
font-family: 'Arial Narrow';
font-size: 3em;
font-stretch: ultra-condensed;
}
.question {position: absolute;
top: 10%;
left: 52%;
}
p {font-family: 'Arabella Medium', 'Times New Roman';
font-size: 4em;
color: #DB0000;
text-shadow: 1px 1px 2px white;
}
button {width: 8em;
height: 4em;
background-color: #DB0000;
border-radius: 5px;
border-width: 3px;
border-color: white;
}
button[name="Yes"] {position: absolute;
top: 70%;
left: 65%;
}
button[name="No"] {position: absolute;
top: 70%;
left: 20%;

33

}
button:hover {background-color: #740000;
}
a {font-family: 'Arabella Medium', 'Times New Roman';
font-size: 2em;
color: white;
text-decoration: none;
}
a:hover {color: #FFFF00;
text-shadow: 1px 1px 2px #FFA500;
}

34

ПРИЛОЖЕНИЕ 3
Листинг файла beer.php
<?php
require_once("DB_connect.php");
require_once("functions.php");
$page = "beer";
$product_type = "beer";
$PageInfo = get_Page($page);
$ProductInfo = get_Products($product_type);
?>
<!DOCTYPE html>
<html lang="ru-RU">
<head>
<title><?=$PageInfo['page_title'];?></title>
<meta charset="Windows-1251">
<meta name="description"
content="<?=$PageInfo['page_description'];?>">
<meta name="keywords"
content="<?=$PageInfo['page_keywords'];?>">
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="header">
<? include "header.inc"; ?>
</div>
<div class="nav">
<? include "nav.inc"; ?>
</div>
<div class="content">
<table>
<tr>
<th>Название</th>
<th>Описание</th>
</tr>
<? foreach($ProductInfo as $product):?>
<tr>
<td><?=$product['product_name'];?></td>
<td><?=$product['product_desc'];?></td>
</tr>
<?endforeach;?>
</table>
</div>
<div class="footer">
<? include "footer.inc"; ?>
</div>
</body>
</html>

35

ПРИЛОЖЕНИЕ 4
Листинг файла contacts.php
<?php
require_once("DB_connect.php");
require_once("functions.php");
$page = "contacts";
$PageInfo = get_Page($page);
$ContactInfo = get_Contacts();
?>
<!DOCTYPE html>
<html lang="ru-RU">
<head>
<title><?=$PageInfo['page_title'];?></title>
<meta name="description"
content="<?=$PageInfo['page_description'];?>">
<meta name="keywords"
content="<?=$PageInfo['page_keywords'];?>">
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="header">
<? include "header.inc"; ?>
</div>
<div class="nav">
<? include "nav.inc"; ?>
</div>
<div class="content">
<h1><?=$PageInfo['page_header']; ?></h1>
<table>
<? foreach($ContactInfo as $contact):?>
<tr>
<td><?=$contact['contact_type'];?></td>
<td><?=$contact['contact_caption'];?></td>
</tr>
<?endforeach;?>
</table>
</div>
<div class="footer">
<? include "footer.inc"; ?>
</div>
</body>
</html>

36

ПРИЛОЖЕНИЕ 5
Листинг файла DB_connect.php
<?php
//Подключение БД
$link = mysql_connect('localhost', 'root', '');
$db = mysql_select_db('bryanskpivo');
mysql_query("set names 'CP1251'");
if (mysqli_connect_errno()) {
echo 'Ошибка подключения к базе данных
('.mysqli_connect_errno(). '): '.mysqli_connect_error();
exit();
}
?>

37

ПРИЛОЖЕНИЕ 6
Листинг файла header.inc
<header>
<img src="https://cfo.spr.ru/pages_logotip/201411/23752.png">
<h1>АО "Брянскпиво"</h1>
</header>

Листинг файла footer.inc
<?php
//Подключение БД
$link = mysql_connect('localhost', 'root', '');
$db = mysql_select_db('bryanskpivo');
mysql_query("set names 'CP1251'");
if (mysqli_connect_errno()) {
echo 'Ошибка подключения к базе данных
('.mysqli_connect_errno(). '): '.mysqli_connect_error();
exit();
}
?>

38

ПРИЛОЖЕНИЕ 7
Листинг файла functions.php
<?php
function get_Page($page) {
$sql = "SELECT * FROM `pages` WHERE `page_name`=
'$page'";
$result = mysql_query($sql);
//var_dump($result);
//return $result;
$PageData = mysql_fetch_assoc($result);
return $PageData;
}
function get_Articles() {
$sql = "SELECT * FROM `articles` ORDER BY `article_date`
DESC LIMIT 10";
$result = mysql_query($sql);
$arr = array();
while ($MyRow = mysql_fetch_assoc($result)) {
$ArticleData[] = $MyRow;
}
return $ArticleData;
}
function get_Products($product_type) {
$sql = "SELECT * FROM `products`WHERE `product_type` =
'$product_type'";
$result = mysql_query($sql);
$arr = array();
while ($MyRow = mysql_fetch_assoc($result)) {
$ProductData[] = $MyRow;
}
return $ProductData;
print_r($ProductData);
}
function get_Promo() {
$sql = "SELECT * FROM `promo` ORDER BY `promo_date` DESC
LIMIT 10";
$result = mysql_query($sql);

39

$arr = array();
while ($MyRow = mysql_fetch_assoc($result)) {
$PromoData[] = $MyRow;
}
return $PromoData;
}
function get_Photo() {
$sql = "SELECT * FROM `photos`";
$result = mysql_query($sql);
$arr = array();
while ($MyRow = mysql_fetch_assoc($result)) {
$PhotoData[] = $MyRow;
}
return $PhotoData;
}
function get_Contacts() {
$sql = "SELECT * FROM `contacts`";
$result = mysql_query($sql);
$arr = array();
while ($MyRow = mysql_fetch_assoc($result)) {
$ContactsData[] = $MyRow;
}
return $ContactsData;
}
?>

40

ПРИЛОЖЕНИЕ 8
Листинг файла gallery.php
<?php
require_once("DB_connect.php");
require_once("functions.php");
$page = "gallery";
$PageInfo = get_Page($page);
$PhotoInfo = get_Photo();
?>
<!DOCTYPE html>
<html lang="ru-RU">
<head>
<title><?=$PageInfo['page_title'];?></title>
<meta name="description"
content="<?=$PageInfo['page_description'];?>">
<meta name="keywords"
content="<?=$PageInfo['page_keywords'];?>">
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="header">
<? include "header.inc"; ?>
</div>
<div class="nav">
<? include "nav.inc"; ?>
</div>
<div class="content">
<h1><?=$PageInfo['page_header']; ?></h1>
<table align="center">
<? foreach($PhotoInfo as $photo):?>
<tr>
<td><img
src='<?=$photo['photo_name'];?>'></td>
</tr>
<tr>
<td><?=$photo['photo_caption'];?></td>
</tr>
<?endforeach;?>
</table>
</div>
</div>
<div class="footer">
<? include "footer.inc"; ?>
</div>
</body>
</html>

41

ПРИЛОЖЕНИЕ 9
Листинг файла history.php
<?php
require_once("DB_connect.php");
require_once("functions.php");
$page = "history";
$PageInfo = get_Page($page);
?>
<!DOCTYPE html>
<html lang="ru-RU">
<head>
<link rel="stylesheet" type="text/css" href="/style.css">
<title><?=$PageInfo['page_title']?></title>
<meta name="description" content="<?=$PageInfo[
'page_description']?>">
<meta name="keywords"
content="<?=$PageInfo['page_keywords']?>">
</head>
<body>
<div class="header">
<? include "/header.inc";?>
</div>
<div class="nav">
<? include "/nav.inc";?>
</div>
<div class="content">
<p><?=$PageInfo['page_content']?></p>
</div>
<div class="footer">
<? include"/footer.inc"; ?>
</div>
</body>
</html>

42

ПРИЛОЖЕНИЕ 10
Листинг файла index.php
<html>
<head>
<link rel="stylesheet" type="text/css"
href="/landing.css">
<title>АО "Брянскпиво"</title>
</head>
<body>
<div class="background">
<img src="images/warning.png">
<div class="question">
<p>Вам есть 18 лет?</p>
<div class="buttons">
<button name="Yes">
<a href="/main.php">Да</a>
</button>
<button name="No">
<a href="https://www.disney.ru">Нет</a>
</button>
</div>
</div>
</div>
</body>
</html>

43

ПРИЛОЖЕНИЕ 11
Листинг файла main.php
<?php
require_once("DB_connect.php");
require_once("functions.php");
$page = "main";
$PageInfo = get_Page($page);
//print_r($PageInfo);
?>
<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css"
href="/style.css">
<title><?=$PageInfo['page_title']?></title>
<meta name="description" content="<?=$PageInfo[
'page_description']?>">
<meta name="keywords"
content="<?=$PageInfo['page_keywords']?>">
</head>
<body>
<div class="header">
<? include("/header.inc"); ?>
</div>
<div class = "nav">
<? include("/nav.inc"); ?>
</div>
<div class="content">
<p><?=$PageInfo['page_content']?></p>
</div>
<? include("/footer.inc"); ?>
</body>
</html>

44

ПРИЛОЖЕНИЕ 12
Листинг файла news.php
<?php
require_once("DB_connect.php");
require_once("functions.php");
$page = "news";
$PageInfo = get_Page($page);
$ArticleInfo = get_Articles();
?>
<!DOCTYPE html>
<html lang="ru-RU">
<head>
<title><?=$PageInfo['page_title'];?></title>
<meta name="description"
content="<?=$PageInfo['page_description'];?>">
<meta name="keywords"
content="<?=$PageInfo['page_keywords'];?>">
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="header">
<? include "header.inc"; ?>
</div>
<div class="nav">
<? include "nav.inc"; ?>
</div>
<div class="content">
<h1><?=$PageInfo['page_header']; ?></h1>
<div class="ArticleList">
<table>
<? foreach($ArticleInfo as $article):?>
<tr>
<td><?=$article['article_title'];?></td>
<td><?=$article['article_date'];?></td>
</tr>
<tr>
<td
colspan="2"><?=$article['article_desc'];?></td>
</tr>
<tr>
</tr>
<?endforeach;?>
</table>
</div>
</div>
<div class="footer">
<? include "footer.inc"; ?>
</div>
</body>
</html>

45

ПРИЛОЖЕНИЕ 13
Листинг файла non_alco.php
<?php
require_once("DB_connect.php");
require_once("functions.php");
$page = "non_alco";
$product_type = "kvas";
$PageInfo = get_Page($page);
$ProductInfo = get_Products($product_type);
?>
<!DOCTYPE html>
<html lang="ru-RU">
<head>
<title><?=$PageInfo['page_title'];?></title>
<meta charset="Windows-1251">
<meta name="description"
content="<?=$PageInfo['page_description'];?>">
<meta name="keywords"
content="<?=$PageInfo['page_keywords'];?>">
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="header">
<? include "header.inc"; ?>
</div>
<div class="nav">
<? include "nav.inc"; ?>
</div>
<div class="content">
<table>
<tr>
<th>Название</th>
<th>Описание</th>
<th>Изображение</th>
</tr>
<? foreach($ProductInfo as $product):?>
<tr>
<td><?=$product['product_name'];?></td>
<td><?=$product['product_desc'];?></td>
</tr>
<?endforeach;?>
<? $product_type = "water"; ?>
<? foreach($ProductInfo as $product):?>
<tr>
<td><?=$product['product_name'];?></td>
<td><?=$product['product_desc'];?></td>
</tr>
<?endforeach;?>
</table>
</div>

46

<p></p>
<div class="footer">
<? include "footer.inc"; ?>
</div>
</body>
</html>

47

ПРИЛОЖЕНИЕ 14
Листинг файла polls.php
<?php
require_once("DB_connect.php");
require_once("functions.php");
$page = "polls";
$PageInfo = get_Page($page);
ini_set('display_errors',1);
error_reporting(E_ALL|E_STRICT);
include('webPoll.class.php');
webPoll::vote();
?>
<html>
<head>
<title><?=$dataPages['title'];?></title>
<meta name="description"
content="<?=$dataPages['description'];?>">
<meta name="keywords"
content="<?=$dataPages['keywords'];?>">
<link rel="stylesheet" href="style.css" type="text/css">
<link rel="stylesheet" href="poll.css" type="text/css">
<!--[if IE]>
<style> body { behavior: url("res/hover.htc"); } </style>
<![endif]-->
</head>
<body>
<div class="header">
<? include "/header.inc";?>
</div>
<div class="nav">
<? include "nav.inc"; ?>
</div>
<div class="content">
<table>
<tr>
<td>
<?
$a = new webPoll(array(
'Вам нравится наш сайт?',
'Да, круто!',
'Хороший',
'Ну нормальный',
'Можно было и лучше',
'Ужасно!'));
?>
</td>

48

<td>
<?
$b = new webPoll(array(
'Вам нравится продукция АО "Брянскпиво"?',
'Да!',
'Нет!'));
?>
</td>
</tr>
</table>
</div>
<div class="footer">
<? include("/footer.inc"); ?>
</div>
</body>
</html>

49

ПРИЛОЖЕНИЕ 15
Листинг файла promo.php
<?php
require_once("DB_connect.php");
require_once("functions.php");
$page = "products";
$PageInfo = get_Page($page);
$ProductInfo = get_Products;
?>
<!DOCTYPE html>
<html lang="ru-RU">
<head>
<title><?=$PageInfo['page_title'];?></title>
<meta charset="Windows-1251">
<meta name="description"
content="<?=$PageInfo['page_description'];?>">
<meta name="keywords"
content="<?=$PageInfo['page_keywords'];?>">
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="header">
<? include "header.inc"; ?>
</div>
<div class="nav">
<? include "nav.inc"; ?>
</div>
<div class="content">
<h1><?=$PageInfo['page_header']; ?></h1>
<ul>
<li><a href="beer.php">Пиво</a></li>
<li><a href="non_alco.php">Безалкогольные
напитки</a></li>
<li><a href="malt.php">Солод</a></li>
</ul>
</div>
<div class="footer">
<? include "footer.inc"; ?>
</div>
</body>
</html>

50

ПРИЛОЖЕНИЕ 16
Листинг файла webPoll.Class.php
<?php
# для вывода сообщений об ошибках
ini_set('display_errors',0);
error_reporting(E_ALL|E_STRICT);

class webPoll {
const POLL = true;
const VOTES = false;
# количество пикселей для 1% на прямоугольнике вывода
public $scale = 2;
# вопрос и ответы
public $question = '';
public $answers = array();
# разметка HTML
private $header = '<form class="webPoll" method="post"
action="%src%">
<input type="hidden" name="QID"
value="%qid%" />
<h4>%question%</h4>
<fieldset><ul>';
private $center = '';
private $footer = "\n</ul></fieldset>%button%\n</form>\n";
private $button = '<p class="buttons"><button type="submit"
class="vote">Голосовать!</button></p>';
# идентификатор вопроса
private $md5 = '';
/**
* --* Таблица, которая содержит вопросы и список ответов, является
аргументом.
* Создаем HTML либо для списка голосования, либо для списка
результатов в зависимости
* от того, голосовал пользователь или нет
*/
public function __construct($params) {
$this->question = array_shift($params);
$this->answers = $params;
$this->md5 = md5($this->question);

51

$this->header = str_replace('%src%',
$_SERVER['SCRIPT_NAME'], $this->header);
$this->header = str_replace('%qid%', $this->md5, $this>header);
$this->header = str_replace('%question%', $this->question,
$this->header);
# отдельный куки для каждого индивидуального набора
голосования
isset($_COOKIE[$this->md5]) ? $this->poll(self::VOTES) :
$this->poll(self::POLL);
}
private function poll($show_poll) {
$replace = $show_poll ? $this->button : '';
$this->footer = str_replace('%button%', $replace, $this>footer);
if(!$show_poll) {
$results = webPoll::getData($this->md5);
$votes = array_sum($results);
}
for( $x=0; $x<count($this->answers); $x++ ) {
$this->center .= $show_poll ? $this->pollLine($x) :
$this->voteLine($this->answers[$x],$results[$x],$votes);
}
echo $this->header, $this->center, $this->footer;
}
private function pollLine($x) {
isset($this->answers[$x+1]) ? $class = 'bordered' : $class =
'';
return "
<li class='$class'>
<label class='poll_active'>
<input type='radio' name='AID' value='$x' />
{$this->answers[$x]}
</label>
</li>
";
}
private function voteLine($answer,$result,$votes) {
$result = isset($result) ? $result : 0;
$percent = round(($result/$votes)*100);
$width = $percent * $this->scale;
return "
<li>
<div class='result'
style='width:{$width}px;'>&nbsp;</div>{$percent}%
<label class='poll_results'>
$answer
</label>
</li>

52

";
}
/**
static function vote() {
if(!isset($_POST['QID']) || !isset($_POST['AID']) ||
isset($_COOKIE[$_POST['QID']])) {
return;
}
$dbh = new PDO('sqlite:bryanskpivo.db');
$dbh->setAttribute( PDO::ATTR_ERRMODE,
PDO::ERRMODE_EXCEPTION );
try {
$sth = $dbh->prepare( "INSERT INTO poll_results
(QID,AID,votes) values (:QID, :AID, 1)" );
$sth->execute(array($_POST['QID'],$_POST['AID']));
}
catch(PDOException $e) {
# Ошибка 23000 означает, что ключ уже существует,
поэтому надо использовать UPDATE!
if($e->getCode() == 23000) {
try {
$sth = $dbh->prepare( "UPDATE poll_results SET
votes = votes+1 WHERE QID=:QID AND AID=:AID");
$sth>execute(array($_POST['QID'],$_POST['AID']));
}
catch(PDOException $e) {
webPoll::db_error($e->getMessage());
}
}
else {
webPoll::db_error($e->getMessage());
}
}
# Вводим значение для $_COOKIE для подтверждения того, что
пользователь проголосовал.
if($sth->rowCount() == 1) {
setcookie($_POST['QID'], 1, time()+60*60*24*365);
$_COOKIE[$_POST['QID']] = 1;
}
}
static function getData($question_id) {
try {
$dbh = new PDO('sqlite:poll_results');
$dbh->setAttribute( PDO::ATTR_ERRMODE,
PDO::ERRMODE_EXCEPTION );
$STH = $dbh->prepare('SELECT AID, votes FROM
poll_results WHERE QID = ?');
$STH->execute(array($question_id));

53

}
catch(PDOException $e) {
# Ошибка при получении данных, просто отправляем пустой
набор данных
return array(0);
}
while($row = $STH->fetch()) {
$results[$row['AID']] = $row['votes'];
}
return $results;
}
/*
* С сообщением об ошибке можно сделать что-нибудь. Например,
отправить e-mail
* или сделать запись в логе
*/
static function db_error($error) {
echo "Ошибка базы данных. $error";
exit;
}
}
?>

54

